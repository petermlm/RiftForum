FROM golang:1.12

ENV GO111MODULE=on
WORKDIR /go/src/app

# Prepare packages
COPY go.mod .
COPY go.sum .
RUN go get -d -v ./...
RUN go install -v ./...

# Install air
RUN apt install -y curl
RUN mkdir -p /air_run
RUN curl -fLo /air_run/air https://raw.githubusercontent.com/cosmtrek/air/master/bin/linux/air
RUN chmod +x /air_run/air

# Copy rest of code base
COPY . .

CMD ["/air_run/air", "-c", "air.conf"]
